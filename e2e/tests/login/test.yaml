name: Email Login
authgear.yaml:
  override: |
    authentication:
        identities:
          - login_id
        primary_authenticators:
          - password
before:
  - type: user_import
    user_import: users.json
steps:
  - action: "create"
    input: |
      {
        "type": "login",
        "name": "default"
      }
    assert:
      - field: "result.action.type"
        op: eq
        value: "identify"

  - input: |
      {
        "identification": "username",
        "login_id": "e2e_login"
      }
    assert:
      - field: "result.action.type"
        op: eq
        value: "authenticate"

  - input: |
      {
        "authentication": "primary_password",
        "password": "password"
      }
    assert:
      - field: "result.action.type"
        op: eq
        value: finished
---
name: Login with unknown account
steps:
  - action: "create"
    input: |
      {
        "type": "login",
        "name": "default"
      }
    assert:
      - field: "result.action.type"
        op: eq
        value: "identify"

  - input: |
      {
        "identification": "username",
        "login_id": "e2e_login_missing"
      }
    assert:
      - field: "error.reason"
        op: eq
        value: "UserNotFound"
