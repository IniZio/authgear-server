name: OAuth
authgear.yaml:
  override: |
    authentication:
        identities:
          - oauth
        primary_authenticators:
          - password

    identity:
      oauth:
        providers:
          - alias: mock
            client_id: "mock"
            type: mock
before:
  - type: user_import
    user_import: users.json
steps:
  - action: "create"
    input: |
      {
        "type": "signup",
        "name": "default"
      }
    assert:
      - field: "result.action.type"
        op: eq
        value: "identify"

  - input: |
      {
        "identification": "oauth",
        "alias": "mock",
        "redirect_uri": "https://mock"
      }
    assert:
      - field: "result.action.type"
        op: eq
        value: "identify"

  - input: |
      {
        "code": "mock"
      }
    assert:
      - field: "result.action.type"
        op: eq
        value: finished
