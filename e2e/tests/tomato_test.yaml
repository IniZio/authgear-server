name: New account with OAuth
project: tomato
steps:
  - action: "create"
    input: |
      {
        "type": "signup_login",
        "name": "default"
      }
    assert:
      - field: "action.type"
        op: eq
        value: "identify"

  - input: |
      {
        "identification": "oauth",
        "alias": "mock",
        "redirect_uri": "https://mock"
      }
    assert:
      - field: "action.type"
        op: eq
        value: "identify"

  - input: |
      {
        "code": "mock"
      }
    assert:
      - field: "error.reason"
        op: eq
        value: AuthenticationFlowNoPublicSignup
---
name: Signup flow
project: tomato
steps:
  - action: "create"
    input: |
      {
        "type": "signup",
        "name": "default"
      }
    assert:
      - field: "error.reason"
        op: eq
        value: AuthenticationFlowNoPublicSignup
---
name: First time login
project: tomato
steps:
  - action: "create"
    input: |
      {
        "type": "login",
        "name": "default"
      }
    assert:
      - field: "action.type"
        op: eq
        value: "identify"

  - input: |
      {
        "identification": "username",
        "login_id": "e2e_tomato_first_time"
      }
    assert:
      - field: "action.type"
        op: eq
        value: "authenticate"

  - input: |
      {
        "authentication": "primary_password",
        "password": "auyeung1234"
      }
    assert:
      - field: "action.type"
        op: eq
        value: authenticate

  - input: |
      {
        "authentication": "primary_oob_otp_sms",
        "index": 0
      }

  - input: |
      {
        "code": "000000"
      }
    assert:
      - field: "action.type"
        op: eq
        value: change_password

  - input: |
      {
        "new_password": "Auyeung1234auyeung1234!"
      }
    assert:
      - field: "action.type"
        op: eq
        value: finished
---
name: Login
project: tomato
steps:
  - action: "create"
    input: |
      {
        "type": "login",
        "name": "default"
      }
    assert:
      - field: "action.type"
        op: eq
        value: "identify"

  - input: |
      {
        "identification": "username",
        "login_id": "e2e_tomato_employee_id"
      }
    assert:
      - field: "action.type"
        op: eq
        value: "authenticate"

  - input: |
      {
        "authentication": "primary_password",
        "password": "Wakanda4ever@Wakanda4ever"
      }
    assert:
      - field: "action.type"
        op: eq
        value: authenticate

  - input: |
      {
        "authentication": "primary_oob_otp_sms",
        "index": 0
      }

  - input: |
      {
        "code": "111111"
      }
    assert:
      - field: "error.reason"
        op: eq
        value: InvalidCredentials

  - input: |
      {
        "code": "000000"
      }
    assert:
      - field: "action.type"
        op: eq
        value: finished
---
name: Recovery - Email
project: tomato
steps:
  - action: "create"
    input: |
      {
          "type": "account_recovery",
          "name": "default"
      }
    assert:
      - field: "action.type"
        op: eq
        value: "identify"

  - input: |
      {
        "identification": "email",
        "login_id": "e2e_tomato_recovery_email@authgear.com"
      }
    assert:
      - field: "action.type"
        op: eq
        value: select_destination

  - input: |
      {
        "index": 0
      }
    assert:
      - field: "action.type"
        op: eq
        value: "verify_account_recovery_code"

  - input: |
      {
        "account_recovery_code": "000000"
      }
    assert:
      - field: "action.type"
        op: eq
        value: "reset_password"

  - input: |
      {
        "new_password": "Abcd1234Abcd1234!"
      }
    assert:
      - field: "action.type"
        op: eq
        value: "finished"
---
name: Recovery - SMS
project: tomato
steps:
  - action: "create"
    input: |
      {
          "type": "account_recovery",
          "name": "default"
      }
    assert:
      - field: "action.type"
        op: eq
        value: "identify"

  - input: |
      {
        "identification": "phone",
        "login_id": "+85223382341"
      }
    assert:
      - field: "action.type"
        op: eq
        value: select_destination

  - input: |
      {
        "index": 0
      }
    assert:
      - field: "action.type"
        op: eq
        value: "verify_account_recovery_code"

  - input: |
      {
        "account_recovery_code": "000000"
      }
    assert:
      - field: "action.type"
        op: eq
        value: "reset_password"

  - input: |
      {
        "new_password": "Abcd1234Abcd1234!"
      }
    assert:
      - field: "action.type"
        op: eq
        value: "finished"
