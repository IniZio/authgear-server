<!DOCTYPE html>
<html>
{{ template "__html_head.html" . }}
<body class="page">
<main class="content">

{{ template "__header.html" . }}

{{ template "__nav_bar.html" true }}

<p class="align-self-center primary-txt">
  Click <a href="/logout">here</a> to sign out.
</p>

<!-- Connected Identities -->
<section class="pane">
  <section class="settings-row settings-page-section-with-title-desc-action">
    <h2 class="title primary-txt">
      {{ template "settings-identity-title" }}
    </h2>
    <p class="description secondary-txt">
      {{ template "settings-page-identity-section-description" }}
    </p>
    <a class="action" href="/settings/identity">
      {{ template "details-button-label" }}
    </a>
  </section>
</section>

<!-- Security -->
<section class="pane">
  <!-- The title and the description -->
  <section class="settings-row settings-page-section-with-title-desc-action">
    <h2 class="title primary-txt">
      {{ template "settings-page-security-section-title" }}
    </h2>
    <p class="description secondary-txt">
      {{ template "settings-page-security-section-description" }}
    </p>
  </section>

  {{ range $.Authenticators }}
  <!-- Primary Password -->
  {{ if eq .Type "password" }}{{ if eq .Kind "primary" }}
  <section class="settings-row settings-page-section-with-title-desc-action">
    <p class="title primary-txt">
      {{ template "settings-page-primary-password-title" }}
    </p>
    <p class="description secondary-txt">
      <!-- FIXME(ui): Use user preferred timezone -->
      {{ template "settings-page-primary-password-description" (dict "time" .UpdatedAt) }}
    </p>
    <a class="action" href="/settings/change_password">
      {{ template "change-password-button-label" }}
    </a>
  </section>
  {{ end }}{{ end }}

  <!-- Primary OOB OTP -->
  {{ if eq .Type "oob_otp" }}{{ if eq .Kind "primary" }}
  <section class="settings-row settings-page-section-with-title-info-desc-action">
    <p class="title primary-txt">
      {{ if eq (index .Claims "https://authgear.com/claims/oob_otp/channel_type") "email" }}
      {{ template "settings-page-primary-oob-otp-title--email" }}
      {{ end }}
      {{ if eq (index .Claims "https://authgear.com/claims/oob_otp/channel_type") "sms" }}
      {{ template "settings-page-primary-oob-otp-title--sms" }}
      {{ end }}
    </p>
    <p class="info secondary-txt">
      {{ if eq (index .Claims "https://authgear.com/claims/oob_otp/channel_type") "email" }}
      <i class="fas fa-envelope" aria-hidden="true"></i>
      {{ index .Claims "https://authgear.com/claims/oob_otp/email" }}
      {{ end }}
      {{ if eq (index .Claims "https://authgear.com/claims/oob_otp/channel_type") "sms" }}
      <i class="fas fa-phone" aria-hidden="true"></i>
      {{ index .Claims "https://authgear.com/claims/oob_otp/phone" }}
      {{ end }}
    </p>
    <p class="description secondary-txt">
      <!-- FIXME(ui): Use user preferred timezone -->
      {{ template "settings-page-primary-oob-otp-description" (dict "time" .CreatedAt) }}
    </p>
    <a class="action" href="/settings/identity">
      {{ template "details-button-label" }}
    </a>
  </section>
  {{ end}}{{ end }}
  {{ end }}

</section>

<!-- MFA -->
<!-- Individual secondary authenticator section is shown if it is allowed in the configuration -->
<!-- or the user somehow has authenticator of that kind -->
{{ $has_secondary_totp := false }}
{{ $has_secondary_oob_otp := false }}
{{ $secondary_password := false }}
{{ range $.Authenticators }}
{{ if eq .Kind "secondary" }}
  {{ if eq .Type "totp" }}
    {{ $has_secondary_totp = true }}
  {{ else if eq .Type "oob_otp" }}
    {{ $has_secondary_oob_otp = true }}
  {{ else if eq .Type "password" }}
    {{ $secondary_password = . }}
  {{ end }}
{{ end }}
{{ end }}
{{ $has_mfa := (or $has_secondary_totp $has_secondary_oob_otp $secondary_password) }}
{{ $show_secondary_totp := (or $has_secondary_totp $.SecondaryTOTPAllowed) }}
{{ $show_secondary_oob_otp := (or $has_secondary_oob_otp $.SecondaryOOBOTPAllowed) }}
{{ $show_secondary_password := (or $secondary_password $.SecondaryPasswordAllowed) }}
{{ $show_mfa := (or $show_secondary_totp $show_secondary_oob_otp $show_secondary_password) }}

{{ if $show_mfa }}
<section class="pane">
  <section class="settings-row settings-page-section-with-title-desc-action">
    <h2 class="title primary-txt">
      {{ template "settings-page-mfa-section-title" }}
    </h2>
    <p class="description secondary-txt">
      {{ template "settings-page-mfa-section-description" }}
    </p>
    <a class="action" href="/settings/mfa">
      {{ template "details-button-label" }}
    </a>
  </section>
</section>
{{ end }}

<!-- Sessions -->
<section class="pane">
  <section class="settings-row settings-page-section-with-title-desc-action">
    <h2 class="title primary-txt">
      {{ template "settings-page-session-section-title" }}
    </h2>
    <p class="description secondary-txt">
      {{ template "settings-page-session-section-description" }}
    </p>
    <a class="action" href="/settings/sessions">
      {{ template "details-button-label" }}
    </a>
  </section>
</section>

</main>
</body>
</html>
