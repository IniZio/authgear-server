{{ template "authflowv2/__page_frame.html" . }}
{{ define "page-content" }}
<div class="flex flex-col gap-y-8">
  <h1 class="screen-title">
  {{ if eq $.AuthenticationStage "secondary" }}
    {{ if eq $.FlowType "reauth" }}
      {{ template "v2-enter-additional-password-page-title-reauth" }}
      {{ else }}
      {{ template "v2-enter-additional-password-page-title" }}
    {{ end }}
    {{ else }}
    {{ if eq $.FlowType "reauth" }}
      {{ template "v2-enter-password-page-title-reauth" }}
      {{ else }}
      {{ template "v2-enter-password-page-title" }}
    {{ end }}
	{{ end }}
  </h1>
  <form method="POST" novalidate class="flex flex-col gap-y-4 items-center">
    {{ $.CSRFField }}
    <!-- This field is for Chrome and Safari to correctly associate the username with the password -->
    {{ if $.PasswordManagerUsername }}
    <input class="hidden"
           aria-hidden="true"
           type="text"
           autocomplete="username"
           name=""
           value="{{ $.PasswordManagerUsername }}">
    {{ end }}
    {{ template "authflowv2/__password_field.html" (dict
      "Ctx" $
      "Name" "x_password"
      "Type" "old-password"
      "AutoFocus" $.ShouldFocusInput
      "Classname" "w-full"
      "HasError" (not (eq .Error nil))
    ) }}
    {{ if $.DeviceTokenEnabled }}
    <div class="flex flex-row items-center self-start gap-x-2">
      <!-- TODO: Integrate checkbox styling from https://github.com/authgear/authgear-server/pull/3648/files#diff-ae1ceba718770ef976b399cb2ca490ae63847974ff7ecf1002c26486e9ce77b5 -->
      <input class="device-token-input"
             id="device-token"
             type="checkbox"
             name="x_device_token"
             value="true">
      <label class="body-text--sm" for="device-token">
{{ template "v2-create-device-token-label" }}
      </label>
    </div>
    {{ end }}
    <!-- TODO: Handle button loading state in https://github.com/authgear/authgear-server/issues/3676 -->
    <button class="primary-btn w-full"
            type="submit"
            name="x_action"
            value=""
            data-authgear-event="authgear.button.enter_password"
            data-action-button>
      {{ template "v2-button.continue" }}
    </button>
    <!-- This page for entering password. So if the user reaches this page normally, forgot password link should be provided -->
    {{ if eq $.AuthenticationStage "primary" }}
    <p class="body-text--md">
      <a href="{{ call $.MakeURL "/authflow/forgot_password" "q_login_id_input_type" $.ForgotPasswordInputType "q_login_id" $.ForgotPasswordLoginID "x_step" "" }}">{{ template "forgot-password-button-label--enter-password-page" }}</a>
    </p>
    {{ end }}
  </form>

  {{ template "authflowv2/__authflow_branch.html" $ }}

</div>

{{ end }}
